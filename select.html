<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Industry Select</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; padding: 24px; }
    .hidden { display: none; }
    .error { color: #b00020; }
    .muted { color: #666; }
    select { min-width: 280px; padding: 8px; }
  </style>
</head>
<body>
  <h1>Choose an Industry</h1>

  <div id="status" class="muted">Loading industries…</div>
  <div id="error" class="error hidden"></div>

  <label for="industrySelect">Industry</label>
  <br />
  <select id="industrySelect" disabled>
    <option value="">Loading…</option>
  </select>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2.45.4";

    // TODO: Replace with your project's details
    const SUPABASE_URL = "https://khhrkgevrhtdlwcdxvbs.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtoaHJrZ2V2cmh0ZGx3Y2R4dmJzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NzA5NTIsImV4cCI6MjA3ODQ0Njk1Mn0.wqd6Uds-7pEr0p1MCrZKRzLzqOPS7ziZO8eGNs_G59c";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const statusEl = document.getElementById("status");
    const errorEl = document.getElementById("error");
    const selectEl = document.getElementById("industrySelect");

    async function loadIndustries() {
      try {
        // Read from the public-only view created earlier
        const { data, error } = await supabase
          .from("industry_public")
          .select("Industry_Name")
          .order("Industry_Name", { ascending: true });

        if (error) throw error;

        // Clear existing options
        selectEl.innerHTML = "";
        // Add a placeholder option
        const placeholder = document.createElement("option");
        placeholder.value = "";
        placeholder.textContent = "Select an industry";
        placeholder.disabled = true;
        placeholder.selected = true;
        selectEl.appendChild(placeholder);

        // Populate options
        for (const row of data || []) {
          const opt = document.createElement("option");
          opt.value = row.Industry_Name;
          opt.textContent = row.Industry_Name;
          selectEl.appendChild(opt);
        }

        // Enable select and update status
        selectEl.disabled = false;
        statusEl.textContent = `Loaded ${data?.length ?? 0} industries.`;
      } catch (err) {
        console.error(err);
        statusEl.classList.add("hidden");
        errorEl.textContent = `Failed to load industries: ${err.message || err}`;
        errorEl.classList.remove("hidden");
      }
    }

    loadIndustries();
  </script>
</body>
</html>
